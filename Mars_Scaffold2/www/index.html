<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>DOE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<meta name="description" content="" />
<meta name="keywords" content="Mars" />
<meta name="author" content="MX" />
<LINK REL="SHORTCUT ICON" HREF="images/mars.ico"> 
<link rel="stylesheet" type="text/css" href="css/mars.css" />
<!-- <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" /> -->
<link href="css/custom-theme/jquery-ui-1.10.2.custom.css" rel="stylesheet">
<!-- <link href="./css/smoothness/jquery-ui-1.10.1.custom.css" rel="stylesheet"> -->
<link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic' rel='stylesheet' type='text/css'>

<script type="text/javascript" src="./js/popcorn-complete.js"></script>	
<!-- 
<script type="text/javascript" src="http://beta.openbadges.org/issuer.js"></script>
<script type="text/javascript" src="https://login.persona.org/include.js"></script>
 -->
<script type="text/javascript" src="./js/libs/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="./js/libs/jquery-ui-1.10.1.custom.min.js"></script>

<script type="text/javascript" src="./js/libs/three.min.js"></script>

		<script src="./js/libs/Detector.js"></script>
		<script src="./js/libs/stats.min.js"></script>
		<script src="./js/libs/tween.min.js"></script>
		<script src="./js/libs/dat.gui.min.js"></script>
		<script src="./js/libs/underscore.min.js"></script>

		<script src="./js/controls/OrbitControls.js"></script>	
		<script src="./js/loaders/ColladaLoader.js"></script>

		
        <script src="js/jat/Constants.js"></script>
        <script src="js/jat/PathUtil.js"></script>
        <script src="js/jat/DE405APL.js"></script>
        <script src="js/jat/DE405Body.js"></script>
        <script src="js/jat/DE405Plus.js"></script>
        <script src="js/jat/Lambert.js"></script>
        <script src="js/jat/LambertException.js"></script>
        <script src="js/jat/MarsOdyssey.js"></script>
        <script src="js/jat/Trajectory.js"></script>
        <script src="js/jat/Matrix.js"></script>
        <script src="js/jat/SolarSystemBodies.js"></script>
        <script src="js/jat/Time.js"></script>
        <script src="js/jat/TimeUtils.js"></script>
        <script src="js/jat/TwoBody.js"></script>
        <script src="js/jat/VectorN.js"></script>
        <script src="js/jat/ZeroFinder.js"></script>

		<script src="./js/utils.js"></script>
		<script src="./js/ephemeris.js"></script>
		<script src="./js/daycount.js"></script>
		<script src="./js/ruler.js"></script>
		<script src="./js/shaderlist.js"></script>

		<script src="./js/label.js"></script>
		<script src="./js/lensflare.js"></script>
		<script src="./js/planet.js"></script>
		<script src="./js/orbit.js"></script>
		<script src="./js/sun.js"></script>
		<script src="./js/solarsystem.js"></script>
		<script src="./js/camtweener.js"></script>
		<script src="./js/main.js"></script>
		<script src="./js/stars.js"></script>
		<script src="./js/jat/Time.js"></script>

		<script src="./js/addlensflare.js"></script>
		
		<script src="./js/sonic.js"></script>


<script type="text/javascript">
//need a value to maintain global user email to check for during session.
//the following variable and function provide separate backpack window to communicate user email value.
var userBackpackEmail;
function setUserBackpackEmail(emailValue) {
	userBackpackEmail = emailValue;
	console.log("user email set to: ",userBackpackEmail);
}



// ensure the web page (DOM) has loaded
document.addEventListener("DOMContentLoaded", function () {
//https://www.youtube.com/watch?v=P4boyXQuUIw - the MSL path
//http://www.youtube.com/watch?v=jEXoMpmfJcM - the MSL launch - a better version
//https://www.youtube.com/watch?v=lKqr3F73bAI - MSL trajectory
			
//blue - 58,132,166 #3a84a6
//bluebg - 13,30,38 #0d1e26 70%
//menu/next green - 135,153,72 #7d9948 
//submenu green - 88,107,54 #586b36
//submenu greenbg - 42,51,24 #2a3318 80%
//header greenbg 31,38,18 #1f2612 70%
//isle blue 76,173,197 #4cadc5

	function preloadimages(arr){
		var newimages=[], loadedimages=0
	    var postaction=function(){}
	    var arr=(typeof arr!="object")? [arr] : arr
	    function imageloadpost(){
	        loadedimages++
	        if (loadedimages==arr.length){
	            postaction(newimages) //call postaction and pass in newimages array as parameter
	        }
	    }
	    for (var i=0; i<arr.length; i++){
	        newimages[i]=new Image()
	        newimages[i].src=arr[i]
	        newimages[i].onload=function(){
	            imageloadpost()
	        }
	        newimages[i].onerror=function(){
	            imageloadpost()
	        }
	    }
	    return { //return blank object with done() method
	        done:function(f){
	            postaction=f || postaction //remember user defined callback functions to be called when images load
	        }
	    }

	}


	preloadimages(['./images/solarsystem/sunmap.jpg', 
	               './images/solarsystem/mercurymap.jpg', 
	               './images/solarsystem/venusmap.jpg', 
	               './images/solarsystem/earthmap2.jpg',
	               './images/solarsystem/marsmap.jpg', 
	               './images/solarsystem/jupitermap.jpg', 
	               './images/solarsystem/saturnmap.jpg', 
	               './images/solarsystem/uranusmap.jpg', 
	               './images/solarsystem/neptunemap.jpg', 
	               './images/solarsystem/earthmap2.jpg', 
	               './images/solarsystem/earthmap2.jpg', 
	               './images/solarsystem/earthmap2.jpg']).done(function(images){
	 	//code inside here is run after all images have preloaded
	 	//images parameter is an array of image objects corresponding to the preloaded images
	 	//images[0] references the 1st image etc
	 
	 	console.log("done preloading...");
	
		div.removeChild(infinityloader.canvas);
		$("#loaderdiv").animate({opacity: 0.0}, 500, function() {
	    	$("#loaderdiv").css('pointer-events', 'none');
		});
	});


	//loader
	var infinityloader = new Sonic({
	 
		width: 400,
		height: 200,
		padding: 10,

		stepsPerFrame: 2,
		trailLength: 1,
		pointDistance: .03,

		strokeColor: '#3a84a6',
		
		step: 'fader',

		multiplier: 8,

		setup: function() {
			this._.lineWidth = 5;
		},

		path: [
		
			['arc', 10, 10, 10, -270, -90],
			['bezier', 10, 0, 40, 20, 20, 0, 30, 20],
			['arc', 40, 10, 10, 90, -90],
			['bezier', 40, 0, 10, 20, 30, 0, 20, 20]
		]

	 
	});
	 
	infinityloader.play();
	var div = document.getElementById("canvastarget"); 
	div.appendChild(infinityloader.canvas);
 
	$contenttarget = $("#contenttarget");
	// Create a popcorn instance by calling the Youtube player plugin     
	Popcorn.player( "baseplayer" );
	
	var popcornMedia = new Array();
	var popcornSequenceNumber = 0;
	popcornMedia[0] = Popcorn( '#video' );
	popcornMedia[1] = Popcorn('#SEQ2_VO' );
	popcornMedia[2] = Popcorn('#SEQ3_VOpt1' );
	popcornMedia[3] = Popcorn('#SEQ3_VOpt2' );
	popcornMedia[4] = Popcorn( '#SEQ3_VOpt3' );
	popcornMedia[5] = Popcorn( '#SEQ_3_CAM_1a' );
	popcornMedia[6] = Popcorn( '#SEQ_3_CAM_1b' );//call to action
	popcornMedia[7] = Popcorn( '#SEQ_3_CAM_1c' );
	popcornMedia[8] = Popcorn( '#SEQ_3_CAM_2a' );
	popcornMedia[9] = Popcorn( '#SEQ_3_CAM_2b' );//call to action
	popcornMedia[10] = Popcorn( '#SEQ_3_CAM_3a' );
	popcornMedia[11] = Popcorn( '#SEQ_3_CAM_3b' );//call to action
	popcornMedia[12] = Popcorn( '#SEQ_3_CAM_3c' );
	popcornMedia[13] = Popcorn( '#SEQ_3_CAM_4a' );
	popcornMedia[14] = Popcorn( '#SEQ_3_CAM_4b' );//call to action
	popcornMedia[15] = Popcorn( '#SEQ_3_CAM_4c' );
	popcornMedia[16] = Popcorn( '#SEQ_3_CAM_4d' );
	popcornMedia[17] = Popcorn( '#SEQ_5_CAM' );
	popcornMedia[18] = Popcorn( '#SEQ_6_CAM' );

	var basepop = Popcorn.baseplayer( "#contenttarget" ); //not sure if I'll need this baseplayer
	//var popcorn_branch1_video2 = Popcorn.youtube('#videocontenttarget2', 'https://www.youtube.com/watch?v=lKqr3F73bAI' );
	 


	var threedinitialized;
	var initializethreed = function() {
		if(!threedinitialized) {
			threedinitialized = true;
	        init(); //init the 3D background.
	        animate();

	        gui.destroy();  //remove the test GUI (used by Ryan)
	        //set time to freeze
	        Tweener(timer, {multiplier:.0}, 1);
	        scene.remove(ruler);
		}
	}
	
	basepop.cue( 1, function() {
		initializethreed();
	});
	
	basepop.cue( 2, function() {
		popcornMedia[popcornSequenceNumber].play();
	});
	
	popcornMedia[0].footnote({
	    start: .1,
	    end: 22,
	    target: "headerpanel",
	    text: "Introduction"
	});
	popcornMedia[0].footnote({
	    start: 22,
	    target: "headerpanel",
	    text: "Mission to Mars: Setup"
	});
	popcornMedia[0].footnote({
		start: 1,
		end: 8.5,
	    target: "subtitlepanel",
		text: "Mary Beth Vilhelm<br><font style=\"font-size:14px;\">Mars Colony 1 Astronaut & Senior Geologist</font>",
	});
	popcornMedia[0].cue( 1, function() {
		$("#subtitlepanel").animate({opacity: 1.0}, 500, function() {
        	//$("#subtitlepanel").css('pointer-events', 'none');
    	});
	});
	popcornMedia[0].cue( 8, function() {
		$("#subtitlepanel").animate({opacity: 0.0}, 500, function() {
        	//$("#subtitlepanel").css('pointer-events', 'none');
    	});
	});
	popcornMedia[0].cue( 3, function() {
		$("#headerpanel").animate({opacity: 1.0}, 100, function() {
        	//$("#headerpanel").css('pointer-events', 'none');
    	});
	});

	//basepop.on( "timeupdate", function() {
		//document.getElementById( "footnotediv1" ).innerHTML = this.currentTime();
	//});
	popcornMedia[0].on( "play", function() {
		$("#videocontenttarget").animate({width: 720, height: 405,
											top: "50%", left: "50%",
											margin:"-240px 0 0 -335px"}, 1, function() {
           	//code after completion of animation
       	});
		
    	$("#videocontenttarget").animate({opacity: 1.0}, 100, function() {
           	$("#videocontenttarget").css('pointer-events', 'auto');
       	});
		$("#nextbuttonwrapper").animate({opacity: 1.0}, 200, function() {
        	$("#nextbuttonwrapper").css('pointer-events', 'auto');
    	});

    	$("#backgroundtarget").animate({opacity: 0.0}, 100, function() {
           	$("#backgroundtarget").css('pointer-events', 'none');
       	});

	});
	popcornMedia[0].cue( 8.5, function() {
		$("#videocontenttarget").animate({width: 360, height: 202,
											top: "10%", left: "2%",
											margin:"-0px 0 0 -0px"}, 1000, function() {
			//code after completion of animation
			//camTweener( { x: 0, y: 700, z: 0 }, { x: 0, y: 0, z: 20 }, 3000 );
		});
	});
	popcornMedia[0].on( "ended", function() {
    	$("#videocontenttarget").animate({opacity: 0.0}, 100, function() {
           	$("#videocontenttarget").css('pointer-events', 'none');
       	});

    	$("#incomingmessage").animate({opacity: 1.0}, 1000, function() {
           	$("#incomingmessage").css('pointer-events', 'auto');
       	});
    	
    	advancePopcornMedia();
	});
    popcornMedia[1].on( "ended", function() {
    	advancePopcornMedia();
	});
    

	
    popcornMedia[1].cue( 6.5, function() {
    	Tweener(ssScale, {planetScale:.00001}, 1000);
    	Tweener(ssScale, {sunScale:.000001}, 1000);
    	Tweener(ssScale, {s:.00001}, 1000);
	});
    
    popcornMedia[1].cue( 11, function() {
    	Tweener(ssScale, {s:.000001}, 1000);
	});
    popcornMedia[1].cue( 12, function() {
    	Tweener(ssScale, {sunScale:.00001}, 1000);
    	Tweener(ssScale, {planetScale:.001}, 1000);
    	Tweener(ssScale, {s:.000001}, 1000);
	});
   
    popcornMedia[2].cue( 2, function() {
       	camTweener( { x: 0, y: 700, z: 0 }, { x: 0, y: 0, z: 20 }, 3000 );
	});
    popcornMedia[2].cue( 6, function() {
    	//Tweener(timer, {multiplier:.23}, 2000);
	});

	popcornMedia[2].cue( 10, function() {
		scene.add(ruler);
	});
    popcornMedia[2].on( "ended", function() {
    	advancePopcornMedia();
	});
	popcornMedia[3].cue( 1, function() {
		scene.remove(ruler);
	});
    popcornMedia[3].on( "ended", function() {
    	advancePopcornMedia();
	});

    popcornMedia[3].cue( 15, function() {
    	Tweener(timer, {multiplier:.10}, 1000);
	});
    popcornMedia[4].on( "ended", function() {

		$("#nextbuttonwrapper").animate({opacity: 0.0}, 200, function() {
        	$("#nextbuttonwrapper").css('pointer-events', 'none');
    	});
		
		camTweener( { x: 0, y: 100, z: 500 }, { x: 0, y: 0, z: 0 }, 1500 );
		setTimeout(function(){advancePopcornMedia()},2000);
	});
    
    popcornMedia[5].cue( 8, function() {
		$("#replaybuttonwrapper").animate({opacity: 1.0}, 200, function() {
        	$("#replaybuttonwrapper").css('pointer-events', 'auto');
    	});
	});
	popcornMedia[5].cue( 8.9, function() {
		$("#helpbuttonwrapper").animate({opacity: 1.0}, 200, function() {
        	$("#helpbuttonwrapper").css('pointer-events', 'auto');
    	});
	});

    //setup vars to walk through mouse 3D lesson
    var cancelCallToAction=false;
    var listenToMouseMovements=false;
    var listenToMouseWheel=false;
    var userLessonNumber=0;
    var userMouseAction=[false,false,false,false];
    var mousePosX, mousePosY;
    var callToActionTimeout = new Array();

    popcornMedia[5].on( "ended", function() {
    	//the click/drag test
        listenToMouseMovements=true;
        userMouseAction[userLessonNumber]=true;
        cancelCallToAction=false;
        callToActionTimeout[userLessonNumber] = setTimeout(function(){callToActionUser()},10000);
	});
    popcornMedia[8].on( "ended", function() {
        //the scroll mouse test
        listenToMouseWheel=true;
        userMouseAction[userLessonNumber]=true;
        cancelCallToAction=false;
        callToActionTimeout[userLessonNumber] = setTimeout(function(){callToActionUser()},10000);
	});
    popcornMedia[10].on( "ended", function() {
        //the planet click test (user to click planet earth)
        userMouseAction[userLessonNumber]=true;
        cancelCallToAction=false;
        callToActionTimeout[userLessonNumber] = setTimeout(function(){callToActionUser()},10000);
        
        //temp: just call this until we get needed function from Ryan.
        setTimeout(function(){advanceUser()},5000);
	});

    popcornMedia[13].cue( 2.2, function() {
    	$("#threedcontrols").animate({opacity: 1.0}, 200, function() {
        	$("#threedcontrols").css('pointer-events', 'auto');
    	});
	});
    popcornMedia[13].on( "ended", function() {
        //the button click test (user to click mars button)
        //userMouseAction[userLessonNumber]=true;
        cancelCallToAction=false;
        callToActionTimeout[userLessonNumber] = setTimeout(function(){callToActionUser()},10000);
	});
    
    popcornMedia[16].cue( 2.2, function() {
        //show the badge modal
        //userMouseAction[userLessonNumber]=true;
        //cancelCallToAction=false;
        //callToActionTimeout[userLessonNumber] = setTimeout(function(){callToActionUser()},10000);

        //$('#backpackloginpopupcheckbox').prop('checked', true);
    	//$("#backpackloginpopup").animate({opacity: 1.0}, 200, function() {
        	//$("#backpackloginpopup").css('pointer-events', 'auto');
    	//});
    	
    	//popBadgeWindow(); //trigger a 'user' button click to avoid popup block (which doesn't work...)
    	document.getElementById('popit').click();
	});

    popcornMedia[16].on( "ended", function() {
        $("#selectmissionrocket").animate({opacity: 1.0}, 200, function() {
        	$("#selectmissionrocket").css('pointer-events', 'auto');
    	});
	});

    
    $(document).on('mouseup', function(e) {
        if(!listenToMouseMovements) return;
        //console.log("got me a mouseup: " + userMouseAction[userLessonNumber]);
        if(userMouseAction[userLessonNumber]) {
        	//get event
        	if (!e) var e = window.event;
        	var clickedElement = (e.target || e.srcElement);
        	//check to make sure that we're clicking the 3d canvas object (the only one)
        	if(clickedElement!="[object HTMLCanvasElement]") return;
        	//check to see if the user moved the mouse.
        	var newMousePosX, newMousePosY;
        	
        	if (e.pageX || e.pageY) 	{
        		newMousePosX = e.pageX;
        		newMousePosY = e.pageY;
        	}
        	else if (e.clientX || e.clientY) 	{
        		newMousePosX = e.clientX + document.body.scrollLeft
        			+ document.documentElement.scrollLeft;
        		newMousePosY = e.clientY + document.body.scrollTop
        			+ document.documentElement.scrollTop;
        	}

        	//console.log("x: " + newMousePosX + "   y: " + newMousePosY);
        	if(mousePosX!=newMousePosX || mousePosY!=newMousePosY ) {
        		advanceUser();
        	} else {
        		congradulateUserForDoingSomethingGood();	
        	}
        }
    });
    
    $(document).on('mousedown', function(e) {
    	if(!listenToMouseMovements) return;
    	cancelCallToAction=true;
    	
    	//record mouse down possition
    	if (!e) var e = window.event;
    	//check to make sure that we're clicking the 3d canvas object (the only one)
    	var clickedElement = (e.target || e.srcElement);
    	if(clickedElement!="[object HTMLCanvasElement]") return;
    	
    	if (e.pageX || e.pageY) 	{
    		mousePosX = e.pageX;
    		mousePosY = e.pageY;
    	}
    	else if (e.clientX || e.clientY) 	{
    		mousePosX = e.clientX + document.body.scrollLeft
    			+ document.documentElement.scrollLeft;
    		mousePosY = e.clientY + document.body.scrollTop
    			+ document.documentElement.scrollTop;
    	}
    	
    });
  
	//Firefox has no implemented $(document).on('mousewheel', function) so we call mousywheely(e) for XBrowser support
    var mousewheelevt=(/Firefox/i.test(navigator.userAgent))? "DOMMouseScroll" : "mousewheel" //FF doesn't recognize mousewheel as of FF3.x
    
   	if (document.attachEvent) //if IE (and Opera depending on user setting)
   	    document.attachEvent("on"+mousewheelevt, mousywheely)
   	else if (document.addEventListener) //WC3 browsers
   	    document.addEventListener(mousewheelevt, mousywheely, false)
    	
    function mousywheely(e){
    	if(!listenToMouseWheel) return;
    	var evt=window.event || e //equalize event object
        var delta=evt.detail? evt.detail*(-120) : evt.wheelDelta //check for detail first so Opera uses that instead of wheelDelta
        console.log("mousewheel delta: " + delta);
        if(delta>0) { //the user zoomed in
        	listenToMouseWheel=false;
        	setTimeout(function(){advanceUser()},1000);
        }
    }
    
    var congradulateUserForDoingSomethingGood = function () {
		if(userLessonNumber==0) {
			jumpPopcornMedia(7);
		}
    }
    var advanceUser = function () {
		listenToMouseMovements=false;
		cancelCallToAction=false;
		clearTimeout(callToActionTimeout[userLessonNumber]);
		
		switch(userLessonNumber)
    	{
    	case 0:
			jumpPopcornMedia(8);
    	  break;
    	case 1:
			jumpPopcornMedia(10);
    	  break;
    	case 2:
			jumpPopcornMedia(13);
    	  break;
    	case 3:
			//no 4th mouse lesson
    	  break;
    	default:
    	  //no default audio
    	}
		
    	userLessonNumber++; //update to next lesson
		
    }
    
    var replayUser = function () {
		clearTimeout(callToActionTimeout[userLessonNumber]);
		
		cancelCallToAction=false;
	    listenToMouseMovements=false;
	    listenToMouseWheel=false;
	    userLessonNumber=0;
	    for(var i=0;i<userMouseAction.length;i++) {
	    	userMouseAction[i]=false;
	    }
		
		
		camTweener( { x: 0, y: 100, z: 500 }, { x: 0, y: 0, z: 0 }, 1500 );
		
		jumpPopcornMedia(5);
		
		/*
		switch(userLessonNumber)
    	{
    	case 0:
			jumpPopcornMedia(5);
    	  break;
    	case 1:
			jumpPopcornMedia(10,1.5);
    	  break;
    	case 2:
			jumpPopcornMedia(13,1.0);
    	  break;
    	case 3:
    	  break;
    	default:
    	  //no default audio
    	}
		*/
    }
    
    var callToActionUser = function () {
    	if(cancelCallToAction) return;
    	
    	switch(userLessonNumber)
    	{
    	case 0:
			jumpPopcornMedia(6);
    	  break;
    	case 1:
			jumpPopcornMedia(9);
    	  break;
    	case 2:
			jumpPopcornMedia(11);
    	  break;
    	case 3:
			jumpPopcornMedia(14);
    	  break;
    	default:
    	  //no default audio
    	}
    }

    var checkForFourthCameraLesson = function () {
    	if(!userMouseAction[userLessonNumber]) {
    		jumpPopcornMedia(15);
    	}
    }
    var finishFourthCameraLesson = function () {
    	if(!userMouseAction[userLessonNumber]) {
    		clearTimeout(callToActionTimeout[userLessonNumber]);
    		userMouseAction[userLessonNumber]=true;
    		jumpPopcornMedia(16);
    	}
    }
    
    var advancePopcornMedia = function () {
		popcornSequenceNumber++;
    	if(popcornSequenceNumber<popcornMedia.length) {
    		popcornMedia[popcornSequenceNumber].play(0);
    	}
    }
    
    //a way to skip around (needed for Next button and Menu buttons)
    var jumpPopcornMedia = function (sequenceNum, beginningOffset) {
		if(popcornSequenceNumber>=popcornMedia.length)return;
		popcornSequenceNumber=sequenceNum;
		//clear div targets
    	//hideeverything();
		
		//stop all other media
		for(var i=0;i<popcornMedia.length;i++) {
			popcornMedia[i].pause();
		}
		
		//jump to desired media
		if(popcornSequenceNumber==0 && !threedinitialized) {
			basepop.play(0);
		} else {
			if(beginningOffset) {
				popcornMedia[popcornSequenceNumber].play(beginningOffset);
			} else {
				popcornMedia[popcornSequenceNumber].play(0);
			}
		}
    }
    
	var hideeverything = function() {
		$("#startmenupanel").animate({opacity: 0.0}, 1, function() { $("#startmenupanel").css('pointer-events', 'none'); });
		$("#menupanel").animate({opacity: 0.0}, 1, function() { $("#menupanel").css('pointer-events', 'none'); });
		
		$("#videocontenttarget").animate({opacity: 0.0}, 1, function() { $("#videocontenttarget").css('pointer-events', 'none'); });
		
		$("#aboutpopup").animate({opacity: 0.0}, 1, function() { $("#aboutpopup").css('pointer-events', 'none'); });
		$("#helppopup").animate({opacity: 0.0}, 1, function() { $("#helppopup").css('pointer-events', 'none'); });
		$("#helpthreedpopup").animate({opacity: 0.0}, 1, function() { $("#helpthreedpopup").css('pointer-events', 'none'); });
		//$("#browserpopup").animate({opacity: 0.0}, 1, function() { $("#browserpopup").css('pointer-events', 'none'); });
		
		$("#incomingmessage").animate({opacity: 0.0}, 1, function() { $("#incomingmessage").css('pointer-events', 'none'); });
		$("#transmissionmessage").animate({opacity: 0.0}, 1, function() { $("#transmissionmessage").css('pointer-events', 'none'); });
		$("#cmemessage").animate({opacity: 0.0}, 1, function() { $("#cmemessage").css('pointer-events', 'none'); });

		$("#selectmissionrocket").animate({opacity: 0.0}, 1, function() { $("#selectmissionrocket").css('pointer-events', 'none'); });
		$("#launchcontrols").animate({opacity: 0.0}, 1, function() { $("#launchcontrols").css('pointer-events', 'none'); });
		
		$("#nextbuttonwrapper").animate({opacity: 0.0}, 1, function() { $("#nextbuttonwrapper").css('pointer-events', 'none'); });
		$("#helpbuttonwrapper").animate({opacity: 0.0}, 1, function() { $("#helpbuttonwrapper").css('pointer-events', 'none'); });
		$("#replaybuttonwrapper").animate({opacity: 0.0}, 1, function() { $("#replaybuttonwrapper").css('pointer-events', 'none'); });
	}
	
	// Add popcorn events here and other functionality
    //SEQ2_VO.image({
    	//start: 0.1, // Our start time in seconds
    	//end: 14, // Our end time in seconds
    	//src: "./images/planetorder.jpg", 
    	//text: "", 
    	//target: "imagecontenttarget", 
		//effect: "applyclass",
    	//applyclass: "stretchcontent"
    //});
    popcornMedia[16].cue( 6, function() {
       	camTweener( { x: 0, y: 700, z: 0 }, { x: 0, y: 0, z: 0 }, 3000 );
	});
    popcornMedia[4].cue( 6, function() {
       	//camTweener( { x: 0, y: 100, z: 500 }, { x: 0, y: 0, z: 0 }, 1500 );
	});
    
    var pausePoint1=false;

    function flipTimelinePic(picID,imgName)
    {
        var pic1 = document.getElementById(picID); 
        if (pic1 == typeof('undefined')) return;
        pic1.src = imgName;
    }
    
    
    //pop the mission complete
    var popBadgeWindow = function() {
    	//first we should check to see if the user email has been stored
    	//if(userBackpackEmail) {}
    	
    	//then pop the appropriate window
    	var winWidth = 750;
    	var winHeight = 600;
    	badgeWindow = popupwindow("./badge-it-gadget-lite/process-badges/missionComplete.html",
    			"New Badge",winWidth, winHeight);
    }
    
    //generic popup window opening function
    var popitbutton = document.getElementById('popit');
    popitbutton.onclick = function() {
    	popBadgeWindow();
    };
    
    function popupwindow(url, title, w, h) {
    	  var left = (screen.width/2)-(w/2);
    	  var top = (screen.height/2)-(h/2);
    	  return window.open(url, title, "titlebar=no,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,copyhistory=no,width="+w+", height="+h+", top="+top+", left="+left);
    }
    
    var selectmissioncontinue = document.getElementById('selectmissioncontinuebutton');
    selectmissioncontinue.style.cursor = 'pointer';
    selectmissioncontinue.onclick = function() {
    	$("#selectmissionrocket").animate({opacity: 0.0}, 200, function() {
        	$("#selectmissionrocket").css('pointer-events', 'none');
        	$("#launchcontrols").animate({opacity: 1.0}, 200, function() {
            	$("#launchcontrols").css('pointer-events', 'auto');
            });
        });
    };
    
    var backpackloginpopupclose = document.getElementById('backpackloginpopupclose');
    backpackloginpopupclose.style.cursor = 'pointer';
    backpackloginpopupclose.onclick = function() {
    	$("#backpackloginpopup").animate({opacity: 0.0}, 200, function() {
        	$("#backpackloginpopup").css('pointer-events', 'none');
        });
    };
    
    var aboutpopupclose = document.getElementById('aboutpopupclose');
    aboutpopupclose.style.cursor = 'pointer';
    aboutpopupclose.onclick = function() {
    	$("#aboutpopup").animate({opacity: 0.0}, 200, function() {
        	$("#aboutpopup").css('pointer-events', 'none');
        });
    };
    
    var helppopupclose = document.getElementById('helppopupclose');
    helppopupclose.style.cursor = 'pointer';
    helppopupclose.onclick = function() {
    	$("#helppopup").animate({opacity: 0.0}, 200, function() {
        	$("#helppopup").css('pointer-events', 'none');
        });
    };
    
    var helpthreedpopupclose = document.getElementById('helpthreedclose');
    helpthreedclose.style.cursor = 'pointer';
    helpthreedclose.onclick = function() {
    	$("#helpthreedpopup").animate({opacity: 0.0}, 200, function() {
        	$("#helpthreedpopup").css('pointer-events', 'none');
        });
    };
    
    var browserpopupclose = document.getElementById('browserpopupclose');
    browserpopupclose.style.cursor = 'pointer';
    browserpopupclose.onclick = function() {
    	$("#browserpopup").animate({opacity: 0.0}, 200, function() {
        	$("#browserpopup").css('pointer-events', 'none');
        });
    };
    
    var incomingtransmissionclose = document.getElementById('ignorebutton');
    incomingtransmissionclose.onclick = function() {
    	$("#incomingmessage").animate({opacity: 0.0}, 200, function() {
        	$("#incomingmessage").css('pointer-events', 'none');
        });
    };
    
    var cmemessageclose = document.getElementById('ignorecmebutton');
    cmemessageclose.onclick = function() {
    	$("#cmemessage").animate({opacity: 0.0}, 200, function() {
        	$("#cmemessage").css('pointer-events', 'none');
        });
    };
    
    /*
    var runbutton = document.getElementById('runbutton');
    runbutton.style.cursor = 'pointer';
    runbutton.onclick = function() {
		console.log("run button hit");

	    runSimulation();
    };
    

	var launchDate;
	var landingDate;
	var runSimulation = function() {
		if(!launchDate || !landingDate) {
			console.log("need both dates to compare");
		} else if (landingDate<launchDate) {
			console.log("You can't land before you launch");
		} else if (landingDate>launchDate) {
			console.log("ok, we can launch this!");
			
			departure_time = new Time( dateToTime(launchDate) );
			arrival_time = new Time( dateToTime(landingDate) );

	    	console.log("departure time jd_tt: " + departure_time.jd_tt());
	    	
	    	var aDate = new Number(timer.JD).Julian2Date();
	    	console.log("timer.JD: " + aDate);

	    	var jd = new Number(departure_time.jd_tt()).Julian2Date();
	    	console.log("departure time jd: " + jd);

			console.log("launchDate: " + launchDate);
			console.log("landingDate: " + landingDate);


	    	console.log("reinitializing Odyssey: ");
			marsOdyssey.init( departure_time, arrival_time );
			
	    	console.log("setting this bad boy into motion... ");
	    	Tweener(timer, {multiplier:.05}, 500);
		}
	}
    */
	
	
    
    //selectmissionrocket div
    var checkboxrocket1 = document.getElementById('checkboxrocket1');
    checkboxrocket1.onclick = function() {
   		$('#checkboxrocket1').prop('checked', true);
   		$('#checkboxrocket2').prop('checked', false);
   		$('#checkboxrocket3').prop('checked', false);
   		document.getElementById("rocketselect").src="./images/rocket_falcon.png";
   		document.getElementById("rocketlaunch").src="./images/rocket_falcon.png";
    };
    var checkboxrocket2 = document.getElementById('checkboxrocket2');
    checkboxrocket2.onclick = function() {
   		$('#checkboxrocket2').prop('checked', true);
   		$('#checkboxrocket1').prop('checked', false);
   		$('#checkboxrocket3').prop('checked', false);
   		document.getElementById("rocketselect").src="./images/rocket_deltaIV.png";
   		document.getElementById("rocketlaunch").src="./images/rocket_deltaIV.png";
    };
    var checkboxrocket3 = document.getElementById('checkboxrocket3');
    checkboxrocket3.onclick = function() {
   		$('#checkboxrocket3').prop('checked', true);
   		$('#checkboxrocket1').prop('checked', false);
   		$('#checkboxrocket2').prop('checked', false);
   		document.getElementById("rocketselect").src="./images/rocket_nasasls.png";
   		document.getElementById("rocketlaunch").src="./images/rocket_nasasls.png";
    };
    
    $("#rocket1").hover(function() {
    	$("#rocket1details").animate({opacity: 1.0}, 200, function() {
        	$("#rocket1details").css('pointer-events', 'auto');
        });
    }, function() {
    	$("#rocket1details").animate({opacity: 0.0}, 200, function() {
        	$("#rocket1details").css('pointer-events', 'none');
        });
    });
    
    $("#rocket2").hover(function() {
    	$("#rocket2details").animate({opacity: 1.0}, 200, function() {
        	$("#rocket2details").css('pointer-events', 'auto');
        });
    }, function() {
    	$("#rocket2details").animate({opacity: 0.0}, 200, function() {
        	$("#rocket2details").css('pointer-events', 'none');
        });
    });
    
    $("#rocket3").hover(function() {
    	$("#rocket3details").animate({opacity: 1.0}, 200, function() {
        	$("#rocket3details").css('pointer-events', 'auto');
        });
    }, function() {
    	$("#rocket3details").animate({opacity: 0.0}, 200, function() {
        	$("#rocket3details").css('pointer-events', 'none');
        });
    });
   

	$('#checkboxrocket1').prop('checked', true);
    
    
    
    $(document).ready(function() {
    	//jQuery style button handling... may change this to avoid jQuery CSS injection.
    	
        $('#playtoggle').bind("click", function() {
          if ($(this).attr("class") == "play") {
             $(this).attr("class", "pause");
 			popcornMedia[1].play();
 			basepop.play();
          } else {
             $(this).attr("class", "play");
 			popcornMedia[1].pause();
 			basepop.pause();
          }
        });
        
        $("#slide2").click(function() {
        	popcornMedia[1].play(7);
        });
        
        $("#slide3").click(function() {
        	popcornMedia[1].play(19);
        });
        
        $("#slide4").click(function() {
        	popcornMedia[1].play(39);
        });
        
        
        $( "#slider" ).slider( { 
			animate: true,
			range: "min",
			value: 50,
			min: 10,
			max: 100,
			step: 1,

		});

		$( "#replaybutton" )
			.button()
			.click(function( event ) {
			replayUser();
		    cancelCallToAction=true;
		    //callToActionTimeout[userLessonNumber] = setTimeout(function(){callToActionUser()},10000);

		});

		$( "#threedhome" )
			.button()
			.click(function( event ) {

				camNextPosition	= {
						x: -100, 
						y: 400, 
						z: -250 
					};

					camNextTarget = {
						x: 0,
						y: 0,
						z: 0
					};

					TWEEN.removeAll();
					camTweener( camNextPosition, camNextTarget, 1500 );
					checkForFourthCameraLesson();
		});	

		$( "#threedrover" )
			.button()
			.click(function( event ) {

				camNextPosition	= {
					x: 0, 
					y: 1000, 
					z: 5000 
				};

				camNextTarget = {
					x: 0,
					y: 0,
					z: 0
				};

				TWEEN.removeAll();
				camTweener( camNextPosition, camNextTarget, 1500 );
				checkForFourthCameraLesson();
		});

		$( "#threedearth" )
			.button()
			.click(function( event ) {


				camNextTarget = {
					x: 0,
					y: 50,
					z: 500
				};

				//not yet sure how to set this up
				camEarth = new camPosition( { x: 50, y: 50, z: 250 }, ss[3].position, 1500 );
				//TWEEN.removeAll();
				//camTweener( camEarth, camNextTarget, 1500 );
				checkForFourthCameraLesson();
				
		});

		$( "#threedmars" )
			.button()
			.click(function( event ) {

				camNextTarget	= {
					x: 0, 
					y: 50, 
					z: 500 
				};
				//not yet sure how to set this up
				camMars = new camPosition( { x: 75, y: 50, z: 300 }, ss[4].position, 1500 );
				//TWEEN.removeAll();
				//camTweener( camMars, camNextTarget, 1500 );
				finishFourthCameraLesson();
		});
		

		$( "#speedSlider" ).slider( {
			animate: true,
			range: "min",
			value: 0,
			min: -3,
			max: 3,
			step: .010,
			change: function() {
				var sliderVal = $( "#speedSlider" ).slider( "option", "value" );
				Tweener(timer, {multiplier:sliderVal}, 1000);
			}
		});

		$( "#menubutton" )
			.button()
			.click(function( event ) {
				if($('#menupanel').css('opacity') != 0) {
	            	$("#menupanel").animate({opacity: 0.0}, 200, function() {
	                	$("#menupanel").css('pointer-events', 'none');
	            	});
	        	} else {
	        		$("#menupanel").animate({opacity: 1.0}, 200, function() {
	                	$("#menupanel").css('pointer-events', 'auto');
	            	});
	        	}
		});
		
		$( "#nextbutton" )
			.button()
			.click(function( event ) {
				if(popcornSequenceNumber<5) {
					jumpToThreeDNavigation();
				} else if(popcornSequenceNumber<17) {
					jumpToChallenge();
				}
		});
		
		var jumpToIntroduction = function() {
			//hide everything
			hideeverything();
			//shift 3d model
			initializethreed();
			camTweener( { x: 0, y: 100, z: 500 }, { x: 0, y: 0, z: 0 }, 1500 );
			//show stuff needed
			
			jumpPopcornMedia(0);
		}
		
		var jumpToThreeDNavigation = function() {
			//hide everything
			hideeverything();
	    	$("#backgroundtarget").animate({opacity: 0.0}, 100, function() {
	           	$("#backgroundtarget").css('pointer-events', 'none');
	       	});
	    	//initialize 3d if you need to
			initializethreed();
			//show stuff needed
			setTimeout(function(){
				//shift 3d model
				camTweener( { x: 0, y: 100, z: 500 }, { x: 0, y: 0, z: 0 }, 1500 );
				$("#nextbuttonwrapper").animate({opacity: 1.0}, 200, function() {
		        	$("#nextbuttonwrapper").css('pointer-events', 'auto');
		    	});
			},1000);
			jumpPopcornMedia(5);
		}
		
		var jumpToChallenge = function () {
			//hide everything
			hideeverything();
	    	$("#backgroundtarget").animate({opacity: 0.0}, 100, function() {
	           	$("#backgroundtarget").css('pointer-events', 'none');
	       	});
	    	//initialize 3d if you need to
			initializethreed();
			//show stuff needed
			setTimeout(function(){
				//shift 3d model
				camTweener( { x: 0, y: 700, z: 0 }, { x: 0, y: 0, z: 0 }, 3000 );
				$("#selectmissionrocket").animate({opacity: 1.0}, 200, function() {
	            	$("#selectmissionrocket").css('pointer-events', 'auto');
	        	});
				$("#threedcontrols").animate({opacity: 1.0}, 200, function() {
	            	$("#threedcontrols").css('pointer-events', 'auto');
	        	});
				
			},2000);
			
			jumpPopcornMedia(17);
		}
		
		$( "#threedhelpbutton" )
			.button()
			.click(function( event ) {
				$("#helpthreedpopup").animate({opacity: 1.0}, 200, function() {
                	$("#helpthreedpopup").css('pointer-events', 'auto');
            	});
		});
		
		$( "#introduction" )
			.button()
			.click(function( event ) {
				jumpToIntroduction();
		});
		
		$( "#navigation" )
			.button()
			.click(function( event ) {
				jumpToThreeDNavigation();
		});
		
		$( "#challenge" )
			.button()
			.click(function( event ) {
				jumpToChallenge();
		});
		
		$( "#about" )
			.button()
			.click(function( event ) {
				console.log("about clicked");
				$("#aboutpopup").animate({opacity: 1.0}, 200, function() {
                	$("#aboutpopup").css('pointer-events', 'auto');
            	});
		});
		
		$( "#help" )
			.button()
			.click(function( event ) {
				$("#helppopup").animate({opacity: 1.0}, 200, function() {
                	$("#helppopup").css('pointer-events', 'auto');
            	});
		});
		
		$( "#beginbutton" )
			.button()
			.click(function( event ) {
				basepop.play( 0 );
				$("#startmenupanel").animate({opacity: 0.0}, 200, function() {
                	$("#startmenupanel").css('pointer-events', 'none');
                	//$("#videocontenttarget").animate({opacity: 1.0}, 200, function() {
                    //	$("#videocontenttarget").css('pointer-events', 'auto');
                	//});
            	});
				//$("#playbuttonwrapper").animate({opacity: 1.0}, 200, function() {
                	//$("#playbuttonwrapper").css('pointer-events', 'auto');
            	//});
		});
		

		var launchRewindDate; //date to start launch draw sequence, to see initial draw.
		var launchDate;
		var landingDate;
		$( "#runbutton" )
			.button()
			.click(function( event ) {
				if(!launchDate || !landingDate) {
					console.log("need both dates to compare");
				} else if (landingDate<launchDate) {
					console.log("You can't land before you launch");
				} else if (landingDate>launchDate) {
			    	Tweener(timer, {multiplier:0}, 500);
	    			var jumpToDate = new Date(launchRewindDate).Date2Julian();
	    			timer.JD = jumpToDate;
					
					var departure_time = new Time( dateToTime(launchDate) );
					var arrival_time = new Time( dateToTime(landingDate) );
					
					//departure_time = new Time( { Yr:2013, Mon:5, D:1, Hr:1, Mn:1, S:1 } );
					//arrival_time = new Time( { Yr:2013, Mon:10, D:1, Hr:1, Mn:1, S:1 } );
					

					//var departure_time = new Time( { Yr:2014, Mon:4, D:7, Hr:1, Mn:1, S:1 } );
					//var arrival_time = new Time( { Yr:2014, Mon:9, D:24, Hr:1, Mn:1, S:1 } );
					
			    	console.log("launchDate: " + launchDate);

			    	console.log("departure time jd_tt: " + Number(departure_time.jd_tt()).Julian2Date());
			    	
			    	var aDate = new Number(timer.JD).Julian2Date();
			    	console.log("timer.JD: " + aDate);

			    	var jd = new Number(departure_time.jd_tt()).Julian2Date();
			    	console.log("departure time jd: " + jd);

					console.log("launchDate: " + launchDate);
					console.log("landingDate: " + landingDate);


			    	console.log("reinitializing Odyssey: ");
					marsOdyssey.init( departure_time, arrival_time );
					
			    	

	    			
	    			
			    	Tweener(timer, {multiplier:.05}, 500);
				}
		});
		
		//we've got simple date formatting needs, so this will be sufficient for our project.
		var dateFormatter = function(aDate) {
			var mm = aDate.getMonth() + 1;
			if(mm<10)mm = "0" + mm;
		    var dd = aDate.getDate() + 1;
			if(dd<10)dd = "0" + dd;
		    var yyyy = aDate.getFullYear();
		    var formattedDate = mm + '/' + dd + '/' + yyyy;
		    return formattedDate;
		}
		
		//change a date to a time object (helps for Time initializer)
		var dateToTime = function(aDate) {
			return aLaunchTime = {
					Yr: aDate.getFullYear(),
					Mon: aDate.getMonth()+1,
					D: aDate.getDate(),
					Hr: 1,
					Mn: 1,
					S: 1
					};
		}
		
		/*
		$(function() {
		    $( "#datepicker" ).datepicker({
		      changeMonth: true,
		      changeYear: true,
		      minDate: new Date(1957, 1 - 1, 25),
		      maxDate: new Date(3000, 1 - 1, 25),
		      onSelect: function(dateText, inst) { 
	    			if(timer) {
		    			Tweener(timer, {multiplier:0}, 500);
		    			var jumpToDate = new Date(Date.parse(dateText)).Date2Julian();
		    			//console.log("dateText: " +  dateFormatter(jumpToDate));
		    			timer.JD = jumpToDate;
	    			}

	    			//console.log("jumpToDate: " +  dateFormatter(jumpToDate));
	    		}
		    });
		});*/
		$(function() {
		    $( "#launchdatepicker" ).datepicker({
		      changeMonth: true,
		      changeYear: true,
		      minDate: new Date(1957, 1 - 1, 25),
		      maxDate: new Date(3000, 1 - 1, 25),
		      onSelect: function(dateText, inst) { 
	    			launchDate = new Date(Date.parse(dateText));
	    			launchRewindDate = new Date(Date.parse(dateText));
	    			launchRewindDate.setDate(launchRewindDate.getDate()-5);
	    			if(timer) {
		    			Tweener(timer, {multiplier:0}, 500);
		    			var jumpToDate = new Date(Date.parse(dateText)).Date2Julian();
		    			timer.JD = jumpToDate;
	    			}

	    			//console.log("jumpToDate: " +  dateFormatter(jumpToDate));
	    		}
		    });
		});
		$(function() {
		    $( "#landingdatepicker" ).datepicker({
		      changeMonth: true,
		      changeYear: true,
		      minDate: new Date(1957, 1 - 1, 25),
		      maxDate: new Date(3000, 1 - 1, 25),
		      onSelect: function(dateText, inst) { 
	    			landingDate = new Date(Date.parse(dateText));
	    			if(timer) {
		    			Tweener(timer, {multiplier:0}, 500);
		    			var jumpToDate = new Date(Date.parse(dateText)).Date2Julian();
		    			timer.JD = jumpToDate;
	    			}
	    			//console.log("jumpToDate: " +  dateFormatter(jumpToDate));
	    		}
		    });
		});
		
		//this timer queries the timer object to figure out what the date is 
		//and then sets the datepicker element every 100 ms.
		setInterval(function() { 
			if(timer) {
				var aDate = new Number(timer.JD).Julian2Date();
				document.getElementById( "orbitdate" ).value = dateFormatter(aDate);
			}
		}, 100);
		
      });
    
    
  //from main.js
  if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

	$( '#loadtext' ).show();
	setLoadMessage("Loading the Solar System");

	loader.options.convertUpAxis = true;
	loader.load( './models/galaxy.dae', function ( collada ) {

		dae = collada.scene;
		dae.scale.x = dae.scale.y = dae.scale.z = 60000;
		dae.updateMatrix();

	} );

	loadShaders( shaderList, function (e) {
		shaderList = e;
		postShadersLoaded();
	});

	var postShadersLoaded = function () {
		console.log("v:0.1");
	        //init();
	        //animate();
			$("#loadtext").hide();
    };
      
}, false);

</script>
	</head>
	<body>
		
		<!-- <div id="loaderdiv" style="z-index:20;background-color:#FFFFFF;width:100px;height:100px;opacity:1.0;"></div> -->
		<div id="loaderdiv" class="modalmask" style="z-index:20;opacity:1.0;pointer-events:auto;">
			<div id="loaderpanel" class="badgecontenttarget" style="z-index:21;background-color: rgba(0,0,0,0.8);">
				<p><font style="color:#3a84a6;">Loading the Solar System</font></p>
				<br><br><br>
				<div id="canvastarget"></div>
			</div>
		</div>
		<div id="startmenupanel" class="startmenupanel">
			<h1>Mission to Mars</h1>
			<br>
			<div class="textstyle1">
			In this simulation of sending spacecraft to Mars you will use a 3D model of the solar system to learn
			about the science behind the Curiosity rover.
			</div>
			<br>
			<button id="beginbutton" class="beginbutton">BEGIN</button>
			<br>
			<br>
			<br>
			<div class="textstyle2">
			This project is a collaboration between the U.S. Department of Energy, the Mozilla Foundation, and MX.</div>
			<br>
			<img src="./images/tri_logo.png" style="align: center;">
			<br>
		</div>
		
		<div id="topbar" class="topbar">
		
			<div id="topbarleft" class="topbarleft">
				<div id="headerpanel" class="headerpanel"></div>
			</div>
			<div id="topbarmiddle" class="topbarmiddle">
				<button id="badgebutton" class="badgebutton">Simple Badge</button>
			</div>
			
			<div id="topbarright" class="topbarright">
				<button id="menubutton" class="menubutton">MENU</button>
				<div id="menupanel" class="menupanel">
					<button id="introduction" class="menupanelbutton">introduction</button>
					<br>
					<button id="navigation" class="menupanelbutton">3d navigation</button>
					<br>
					<button id="challenge" class="menupanelbutton">Slayton's Isle</button>
					<br>
					<button id="about" class="menupanelbutton">about</button>
					<br>
					<button id="help" class="menupanelbutton">help</button>
				</div>
			</div>
		</div>	
		<!-- main content area for video, images, 3D, etc... -->
		<div id="contenttarget" class="contenttarget">
		</div>
		<div id="backgroundtarget" class="backgroundtarget">
		</div>
		
		<div id="imagecontenttarget" class="imagecontenttarget">
		</div>
		
		<div id="videocontenttarget" class="videocontenttarget">
			<video height="100%" width="100%" id="video" style="background: #000;">
         		<source src="http://www.mx-mx.com/lab/moku/video/SEQ1_OCVO_v05.mp4" type="video/mp4">
         		<source src="http://www.mx-mx.com/lab/moku/video/SEQ1_OCVO_v05.webmhd.webm" type="video/webm">
         		Please upgrade your browser to view video
       		</video>
       		<div id="subtitlepanel" class="subtitlepanel"></div>
		</div>
		
		<div id="videocontenttarget2" class="videocontenttarget2">
		</div>
		
		<div id="bottombar" class="bottombar">
			<div id="bottombarleft" class="bottombarleft">
				<div id="helpbuttonwrapper" class="helpbuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<button id="threedhelpbutton" class="threedhelpbutton">HELP</button>
				</div>
				<div id="replaybuttonwrapper" class="replaybuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<button id="replaybutton" class="replaybutton">REPLAY</button>
				</div>
			</div>
			<div id="bottombarmiddle" class="bottombarmiddle" style="vertical-align: middle;">
				<div id="threedcontrols" class="threedcontrols">
					<button id="threedhome" class="squarebluebutton">Home</button>
					<button id="threedrover" class="squarebluebutton">Rover</button>
					<button id="threedearth" class="squarebluebutton">Earth</button>
					<button id="threedmars" class="squarebluebutton">Mars</button>
				</div>
			</div>
			
			<div id="bottombarright" class="bottombarright">
			
				<div id="playbuttonwrapper" class="playbuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<div id="playtoggle" class="pause"></div>
				</div>
				<div id="nextbuttonwrapper" class="nextbuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<button id="nextbutton" class="nextbutton">NEXT</button>
				</div>
			</div>
		</div>
		
		<div style="display:none">
			<span id="label_template" class="label">
				<span class="name">
				</span>
			</span>
		</div>
		<div id="loadtext" style="z-index: 6;"></div>
		
		<!--  currently moved into it's own php web page... dealing with popup blocking may be problematic.  would like to move back here -->
		<div id="backpackloginpopup" class="modalmask">
			<div id="backpacklogindiv" class="badgecontenttarget">
				<div id="backpackloginpopupclose" class="closebutton"><p>&#10006;</p></div>
				<h1>Mission Complete!</h1>
				<h1>Badge Award!</h1>
				<br>
				You've earned a badge!!!
				<br><br>
				<!-- <img src="./badge-it-gadget-lite/digital-badges/images/badge_3D.png"> -->
				<br><br><br>
				<button id="popit" class="squarebluebutton">pop</button>
				<br><br>
				<form id="form" method="POST" action="./badge-it-gadget-lite/process-badges/test.php">
					<p><label style="float: left;">Email:</label><input type="text" id="email" name="email"/></p>
					<br><br>
					<div style="float:right;">
						<button id="backpackloginpopupcontinue" type="submit" class="squarebluebutton">Continue</button>
					</div>
					<br><br><br><br>
					<div style="display:inline;float:left">
						<input type="checkbox" id="backpackloginpopupcheckbox" class="regular-checkbox" /> <label class="checkboxlabel">email list</label>
					</div>
				</form>
			</div>
		</div>
		
		<div id="aboutpopup" class="popupdiv">
			<div id="aboutpopupclose" class="closebutton"><p>&#10006;</p></div>
			<h1>About</h1>
			<p>The about page</p>
		</div>
		<div id="helppopup" class="popupdiv">
			<div id="helppopupclose" class="closebutton"><p>&#10006;</p></div>
			<h1>Help</h1>
			<p>The help page</p>
		</div>
		<div id="helpthreedpopup" class="popupdiv">
			<div id="helpthreedclose" class="closebutton"><p>&#10006;</p></div>
			<h1>Help</h1>
			<p>The 3D help page</p>
		</div>
		<div id="browserpopup" class="popupdiv">
			<div id="browserpopupclose" class="closebutton"><p>&#10006;</p></div>
			<h1>Browser</h1>
			<p>The browser page</p>
		</div>
		
		<div id="incomingmessage" class="capcommessagediv">
			<table style="width: 100%;margin:2;padding:0;" >
				<tr >
					<td width="50px" rowspan="2" align="left" valign="middle"><img src="./images/phone_icon.png" style="width:45px;height:45px;"></td>
					
					<td align="left">...Incoming Transmission</td>
				</tr>
				<tr>
					<td align="left">
						<button id="answerbutton" class="roundedbluebutton">Answer</button>
						<button id="ignorebutton" class="roundedbluebutton">Ignore</button>
					</td>
				</tr>
			</table>
		</div>
		
		<div id="transmissionmessage" class="capcommessagediv">
			<table style="width: 100%;margin:2;padding:0;" >
				<tr >
					<td width="50px" rowspan="2" align="left" valign="middle"><img src="./images/phone_icon.png" style="width:45px;height:45px;"></td>
					<td align="left">Current Transmission:</td>
				</tr>
				<tr>
					<td align="left" style="font-weight:400;"> Nasa - Capcom </td>
				</tr>
			</table>
		</div>
		
		<div id="cmemessage" class="capcommessagereddiv">
			<table style="width: 100%;margin:2;padding:0;" >
				<tr >
					<td width="50px" rowspan="2" align="left" valign="middle"><img src="./images/cme_icon.png" style="width:45px;height:45px;"></td>
					
					<td align="left">Alert: CME Detected!</td>
				</tr>
				<tr>
					<td align="left">
						<button id="investigatecmebutton" class="roundedredbutton">Investigate</button>
						<button id="ignorecmebutton" class="roundedredbutton">Ignore</button>
					</td>
				</tr>
			</table>
		</div>
		
		<div id="selectmissionrocket" class="selectitemdiv">
			<div style="position:absolute;float:left;font-weight:bold;font-size:30px;">Select Mission Rocket</div>
			<table style="width: 100%;margin:0;padding:0;">
				<tr>
					<td width="33%" align="center" valign="bottom"><img id="rocket1" src="./images/rocket_falcon.png"></td>
					<td width="33%" align="center" valign="bottom"><img id="rocket2" src="./images/rocket_deltaIV.png"></td>
					<td width="33%" align="center" valign="bottom"><img id="rocket3" src="./images/rocket_nasasls.png"></td>
				</tr>
				<tr>
					<td width="33%" align="center">Falcon Heavy</td>
					<td width="33%" align="center">Delta IV Heavy</td>
					<td width="33%" align="center">NASA SLS</td>
				</tr>
				<tr>
					<td width="33%" align="center"><input type="checkbox" id="checkboxrocket1"  class="regular-checkbox" /></td>
					<td width="33%" align="center"><input type="checkbox" id="checkboxrocket2"  class="regular-checkbox" /></td>
					<td width="33%" align="center"><input type="checkbox" id="checkboxrocket3"  class="regular-checkbox" /></td>
				</tr>	
			</table>
			<div style="position:absolute;bottom:2%;right:10px;font-weight:bold;font-size:30px;">
				<button id="selectmissioncontinuebutton" class="roundedbluebutton">Continue</button>
			</div>
			<!-- appears to the right of the mission selector -->
			<div id="rocket1details" style="opacity: 0.0;pointer-events:none;position:absolute;top:10%;left:101%;width:350px;font-weight:bold;font-size:18px;">
				<table style="width:100%;margin:0;padding:0;background:rgba(0,0,0,.85);border:1px solid rgba(76,173,197,1.0);">
					<tr>
						<td width="100%" align="left" valign="bottom" colspan="3" style="color:rgba(76,173,197,1.0);">Launch Vehicle Layout</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of fuel</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">5 Million</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of payload</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">1000</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of consumable supply</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">400</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom"># of Launches</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">1</td>
					</tr>
					<tr>
						<td width="100%" align="left" valign="bottom" colspan="3" style="color:rgba(76,173,197,1.0);">Astronaut Selection</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom"># of Astronauts</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">3</td>
					</tr>
				</table>
			</div>
			<div id="rocket2details" style="opacity: 0.0;pointer-events:none;position:absolute;top:10%;left:101%;width:350px;font-weight:bold;font-size:18px;">
				<table style="width:100%;margin:0;padding:0;background:rgba(0,0,0,.85);border:1px solid rgba(76,173,197,1.0);">
					<tr>
						<td width="100%" align="left" valign="bottom" colspan="3" style="color:rgba(76,173,197,1.0);">Launch Vehicle Layout</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of fuel</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">8 Million</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of payload</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">500</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of consumable supply</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">200</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom"># of Launches</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">1</td>
					</tr>
					<tr>
						<td width="100%" align="left" valign="bottom" colspan="3" style="color:rgba(76,173,197,1.0);">Astronaut Selection</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom"># of Astronauts</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">2</td>
					</tr>
				</table>
			</div>
			<div id="rocket3details" style="opacity: 0.0;pointer-events:none;position:absolute;top:10%;left:101%;width:350px;font-weight:bold;font-size:18px;">
				<table style="width:100%;margin:0;padding:0;background:rgba(0,0,0,.85);border:1px solid rgba(76,173,197,1.0);">
					<tr>
						<td width="100%" align="left" valign="bottom" colspan="3" style="color:rgba(76,173,197,1.0);">Launch Vehicle Layout</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of fuel</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">12 Million</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of payload</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">12000</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom">LBS of consumable supply</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">700</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom"># of Launches</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">1</td>
					</tr>
					<tr>
						<td width="100%" align="left" valign="bottom" colspan="3" style="color:rgba(76,173,197,1.0);">Astronaut Selection</td>
					</tr>
					<tr>
						<td width="66%" align="left" valign="bottom"># of Astronauts</td>
						<td width="4%" align="left" valign="bottom">=</td>
						<td width="30%" align="left" valign="bottom">3</td>
					</tr>
				</table>
			</div>
		</div>
		
		<div id="launchcontrols" class="launchcontrols">
			 <div id="sliderwrapper" class="sliderwrapper" style="padding-left:120px;">
				Time
				<div id="speedSlider" class="speedSlider"></div>
			</div>
			<div id="inputwrapper" class="inputwrapper">
				Orbit Date
				<input type="text" id="orbitdate" class="datepicker" readonly/>
			</div>
			
			<div id="launchdiv" class="launchdiv">
				<div style="position:absolute;bottom:100%;left:2%;display:inline;font-weight:bold;">
					Simulation <img style="width:11px;height:47px" id="rocketselect" src="./images/rocket_falcon.png">
				</div>
				<table style="width:100%;height:100%;margin:0;padding:0;">
					<tr>
						<td align="center">Launch Date</td>
						<td align="center">Land Date</td>
						<td align="center" rowspan="2"><button id="runbutton" class="playbutton">Run<br><img src="./images/playblue.png"></button></td>
					</tr>
					<tr>
						<td align="center">
				 			<input type="text" id="launchdatepicker" class="datepicker"/>
						</td>
						<td align="center">
				 			<input type="text" id="landingdatepicker" class="datepicker"/>
						</td>
					</tr>
				</table>
				
				<div style="position:absolute;bottom:6%;right:-20%;display:inline;font-weight:bold;text-align:center;">
					Launch<br><font color="#14148f">Commit</font><br> 
					<button id="commitlaunchbutton" class="launchbutton">
						<table style="width:100%;height:100%;margin:0;padding:0;">
							<tr>
								<td align="center"><img style="width:8px;height:35px" id="rocketlaunch" src="./images/rocket_falcon.png"></td>
								<td align="center" valign="middle">&nbsp;&nbsp;<img src="./images/playblue.png"></td>
							</tr>
						</table>
					</button>
				</div>
			</div>
		</div>
		
		
		
		<audio id="SEQ2_VO">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ2_VO.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ2_VO.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id="SEQ3_VOpt1">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ3_VOpt1.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ3_VOpt1.oggvorbis.ogg"></source>
			
		</audio>
		
		<audio id="SEQ3_VOpt2">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ3_VOpt2.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ3_VOpt2.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id="SEQ3_VOpt3">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ3_VOpt3.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ3_VOpt3.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id=SEQ_3_CAM_1a>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_1a.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_1a.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id="SEQ_3_CAM_1b">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_1b.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_1b.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id="SEQ_3_CAM_1c">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_1c.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_1c.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id=SEQ_3_CAM_2a>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_2a.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_2a.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id="SEQ_3_CAM_2b">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_2b.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_2b.oggvorbis.ogg"></source>
			
		</audio> 
		
		<audio id=SEQ_3_CAM_3a>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_3a.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_3a.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="SEQ_3_CAM_3b">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_3b.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_3b.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="SEQ_3_CAM_3c">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_3c.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_3c.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id=SEQ_3_CAM_4a>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4a.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4a.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="SEQ_3_CAM_4b">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4b.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4b.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="SEQ_3_CAM_4c">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4c.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4c.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="SEQ_3_CAM_4d">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4d.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_3_CAM_4d.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="SEQ_5_CAM">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_5_CAM.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_5_CAM.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="SEQ_6_CAM">
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_6_CAM.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/SEQ_6_CAM.oggvorbis.ogg"></source>
		</audio> 
		
	</body>
</html>
