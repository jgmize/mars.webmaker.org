<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>MSL Curiosity</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<meta name="description" content="" />
<meta name="keywords" content="Curiosity" />
<meta name="author" content="MX" />
<LINK REL="SHORTCUT ICON" HREF="images/mars.ico"> 
<link rel="stylesheet" type="text/css" href="css/mars.css" />
<link href="css/custom-theme/jquery-ui-1.10.2.custom.css" rel="stylesheet">
<link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic' rel='stylesheet' type='text/css'>


<script type="text/javascript" src="./js/popcorn-complete.js"></script>	
<script type="text/javascript" src="./js/libs/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="./js/libs/jquery-ui-1.10.1.custom.min.js"></script>

<script src="./js/Detector.js"></script>

<script src="./js/libs/three.min.js"></script>
<script src="./js/libs/physi.js"></script>

<script src="./js/libs/stats.min.js"></script>
<script src="./js/libs/dat.gui.min.js"></script>
<script src="./js/libs/tween.min.js"></script>

<script src="./js/controls/OrbitControls.js"></script>
<script src="./js/loaders/ColladaLoader.js"></script>

<script src="./js/utils.js"></script>
<script src="./js/camtweener.js"></script>
<script src="./js/rover.js"></script>
<script src="./js/outcrop.js"></script>
<script src="./js/mainRover.js"></script>


<script src="./js/sonic.js"></script>
		
<script type="text/javascript">
//need a value to maintain global user email to check for during session.
//the following variable and function provide separate backpack window to communicate user email value.
var userBackpackEmail;
function setUserBackpackEmail(emailValue) {
	userBackpackEmail = emailValue;
	console.log("user email set to: ",userBackpackEmail);
}



// ensure the web page (DOM) has loaded
document.addEventListener("DOMContentLoaded", function () {
//http://www.youtube.com/watch?v=P4boyXQuUIw - good 11 min long animatic of curiosity
//http://www.youtube.com/watch?v=_hN4XdS7NMY&list=PL56421C9A51D1F427 - how do rovers drive on mars
	
	var threedinitialized;
	var initializethreed = function() {
		if(!threedinitialized) {
			threedinitialized = true;
			console.log("initializing MSL on Mars...");
	        init(); //init the 3D background.
	        animate();

	        gui.destroy();  //remove the test GUI (used by Ryan)
			
		}
	}
	
	//loader
	var infinityloader = new Sonic({

		width: 160,
		height: 80,

		stepsPerFrame: 2,
		trailLength: .35,
		pointDistance: .01,
		fps: 25,

		fillColor: '#FF7B24',

		setup: function() {
			this._.lineWidth = 3;
		},

		step: function(point, i, f) {

			var progress = point.progress,
				degAngle = 360 * progress,
				angle = Math.PI/180 * degAngle,
				angleB = Math.PI/180 * (degAngle - 180),
				size = i*3;

			this._.fillRect(
				Math.cos(angle) * 35 + (100-size/2),
				Math.sin(angle) * 15 + (50-size/2),
				size * .75,
				size * .75
			);
			
			this._.fillStyle = '#3a84a6';

			this._.fillRect(
				Math.cos(angleB) * 25 + (100-size/2),
				Math.sin(angleB) * 10 + (50-size/2),
				size,
				size
			);

			this._.fillStyle = '#FFF47A';

			this._.beginPath();
			this._.arc(100, 50, 5, 0, 360, 0);
			this._.closePath();
			this._.fill();


		},

		path: [
			['line', 20, 5, 30, 45]
		]
	 
	});

	//start popcorn definitions/array
	var popcornMedia = new Array();
	var popcornSequenceNumber = 0;
	popcornMedia[0] = Popcorn('#UNIT2_VO_intro' );
	popcornMedia[1] = Popcorn('#UNIT2_VO_1' );
	popcornMedia[2] = Popcorn('#UNIT2_VO_1e1' );
	popcornMedia[3] = Popcorn('#UNIT2_VO_1e2' );
	popcornMedia[4] = Popcorn('#UNIT2_VO_2' );
	popcornMedia[5] = Popcorn('#UNIT2_VO_3' );
	popcornMedia[6] = Popcorn('#UNIT2_VO_3e1' );
	popcornMedia[7] = Popcorn('#UNIT2_VO_3e2' );
	popcornMedia[8] = Popcorn('#UNIT2_VO_4' );
	popcornMedia[9] = Popcorn('#UNIT2_VO_4a' );
	popcornMedia[10] = Popcorn('#UNIT2_VO_4b' );
	popcornMedia[11] = Popcorn('#UNIT2_VO_4e2' );
	popcornMedia[12] = Popcorn('#UNIT2_VO_4e3' );
	popcornMedia[13] = Popcorn('#UNIT2_VO_conclusion' );
	
    popcornMedia[0].on( "play", function() {
    	console.log("on play");
    	//$("#youtubetarget").animate({opacity: 1.0}, 100, function() {
        //   	$("#youtubetarget").css('pointer-events', 'auto');
       	//});

    	$("#backgroundtarget").animate({opacity: 0.0}, 100, function() {
           	$("#backgroundtarget").css('pointer-events', 'none');
       	});
    	
		$("#nextbuttonwrapper").animate({opacity: 1.0}, 200, function() {
        	$("#nextbuttonwrapper").css('pointer-events', 'auto');
    	});
	});
    
    popcornMedia[0].cue( 3, function() {
    	console.log("stowing arm");
    	scene.add(target);
    	stowArm();
	});
    
	popcornMedia[0].on( "ended", function() {
    	//$("#youtubetarget").animate({opacity: 0.0}, 100, function() {
        //   	$("#youtubetarget").css('pointer-events', 'none');
       	//});
    	
    	advancePopcornMedia();
	});
	

    
    var advancePopcornMedia = function () {
		popcornSequenceNumber++;
    	if(popcornSequenceNumber<popcornMedia.length) {
    		popcornMedia[popcornSequenceNumber].play(0);
    	}
    }
    
  //a way to skip around (needed for Next button and Menu buttons)
    var jumpPopcornMedia = function (sequenceNum, beginningOffset) {
		if(popcornSequenceNumber>=popcornMedia.length)return;
		popcornSequenceNumber=sequenceNum;
		//clear div targets
    	//hideeverything();
		
		//stop all other media
		for(var i=0;i<popcornMedia.length;i++) {
			popcornMedia[i].pause();
		}
		
		//jump to desired media
		if(popcornSequenceNumber==0 && !threedinitialized) {
			basepop.play(0);
		} else {
			if(beginningOffset) {
				popcornMedia[popcornSequenceNumber].play(beginningOffset);
			} else {
				popcornMedia[popcornSequenceNumber].play(0);
			}
		}
    }
	 
	
	$(document).ready( function() {
		infinityloader.play();
		var div = document.getElementById("canvastarget"); 
		div.appendChild(infinityloader.canvas);
		
		if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
		var postColladaLoaded = function () {

			console.log("v:0.1");
			
			initializethreed();
			$("#loadtext").hide();
			
			setTimeout(function() {

		        div.removeChild(infinityloader.canvas);
		        $("#loaderdiv").animate({opacity: 0.0}, 500, function() {
		            $("#loaderdiv").css('pointer-events', 'none');
		        });
				
			},2000)

	    };

		roverLoader.options.convertUpAxis = true;
		roverLoader.load( './models/rover.dae', function ( collada ) {

			rover_dae = collada.scene;
			rover_dae.scale.set( 1, 1, 1 );
			rover_dae.updateMatrix();

			terrainLoader.options.convertUpAxis = true;
			terrainLoader.load( './models/terrain.dae', function ( collada ) {
				
				terrain = collada.scene;
				terrain.scale.set( 1, 1, 1 );
				postColladaLoaded();
			});
		});
		

		$( "#menubutton" )
			.button()
			.click(function( event ) {
				if($('#menupanel').css('opacity') != 0) {
	            	$("#menupanel").animate({opacity: 0.0}, 200, function() {
	                	$("#menupanel").css('pointer-events', 'none');
	            	});
	        	} else {
	        		$("#menupanel").animate({opacity: 1.0}, 200, function() {
	                	$("#menupanel").css('pointer-events', 'auto');
	            	});
	        	}
		});
		

		$( "#beginbutton" )
			.button()
			.click(function( event ) {
				//basepop.play( 0 );
				popcornMedia[0].play( 0 );
				$("#startmenupanel").animate({opacity: 0.0}, 200, function() {
                	$("#startmenupanel").css('pointer-events', 'none');
            	});
		    	$("#backgroundtarget").animate({opacity: 0.0}, 1000, function() {
		           	$("#backgroundtarget").css('pointer-events', 'none');
		       	});
		});
		
	});

}, false);

</script>
	</head>

	<body>

		<div id="startmenupanel" class="startmenupanel">
			<h1>The MSL Curiosity</h1>
			<br>
			<div class="textstyle1">
			In this simulation of exploring the Mars Science Lab Curiosity you will use a 3D model of the Curiosity on Mars to learn
			about the science behind the rover.
			</div>
			<br>
			<button id="beginbutton" class="beginbutton">BEGIN</button>
			<br>
			<br>
			<br>
			<div class="textstyle2">
			This project is a collaboration between the U.S. Department of Energy, the Mozilla Foundation, and MX.</div>
			<br>
			<img src="./images/tri_logo.png" style="align: center;">
			<br>
		</div>
	
		<div id="topbar" class="topbar">
		
			<div id="topbarleft" class="topbarleft">
				<div id="headerpanel" class="headerpanel"></div>
			</div>
			<div id="topbarmiddle" class="topbarmiddle">
				<div id="loaderdiv" style="z-index:10;opacity:1.0;pointer-events:auto; width:100%">
					<div id="loaderpanel" class="loadercontenttarget" style="z-index:11;">
						<font style="color:#3a84a6;">Loading the Curiosity MSL</font>
						<div id="canvastarget" style="position:absolute;left:-130px;top:-22px"></div>
					</div>
				</div>
			</div>
			
			<div id="topbarright" class="topbarright">
				<button id="menubutton" class="menubutton">MENU</button>
				<div id="menupanel" class="menupanel">
					<button id="introduction" class="menupanelbutton">introduction</button>
					<br>
					<button id="navigation" class="menupanelbutton">3d navigation</button>
					<br>
					<button id="challenge" class="menupanelbutton">Slayton's Isle</button>
					<br>
					<button id="about" class="menupanelbutton">about</button>
					<br>
					<button id="help" class="menupanelbutton">help</button>
				</div>
			</div>
		</div>	
		<!-- main content area for video, images, 3D, etc... -->
		<div id="contenttarget" class="contenttarget">
		</div>
		<div id="youtubetarget" class="youtubetarget"></div>
		<div id="backgroundtarget" class="curiositybackgroundtarget">
		</div>
		
		<div id="bottombar" class="bottombar">
			<div id="bottombarleft" class="bottombarleft">
				<div id="helpbuttonwrapper" class="helpbuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<button id="threedhelpbutton" class="threedhelpbutton">HELP</button>
				</div>
				<div id="replaybuttonwrapper" class="replaybuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<button id="replaybutton" class="replaybutton">REPLAY</button>
				</div>
			</div>
			<div id="bottombarmiddle" class="bottombarmiddle" style="vertical-align: middle;">
				<div id="threedcontrols" class="threedcontrols">
					<button id="threedhome" class="squarebluebutton">Home</button>
					<button id="threedrover" class="squarebluebutton">Rover</button>
					<button id="threedearth" class="squarebluebutton">Earth</button>
					<button id="threedmars" class="squarebluebutton">Mars</button>
				</div>
			</div>
			
			<div id="bottombarright" class="bottombarright">
			
				<div id="playbuttonwrapper" class="playbuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<div id="playtoggle" class="pause"></div>
				</div>
				<div id="nextbuttonwrapper" class="nextbuttonwrapper" style="opacity: 0.0;pointer-events:none">
					<button id="nextbutton" class="nextbutton">NEXT</button>
				</div>
			</div>
		</div>
		
		<audio id="UNIT2_VO_intro">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_intro.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_intro.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_1">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_1.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_1.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_1e1">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_1e1.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_1e1.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_1e2">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_1e2.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_1e2.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_2">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_2.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_2.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_3">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_3.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_3.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_3e1">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_3e1.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_3e1.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_3e2">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_3e2.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_3e2.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_4">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_4a">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4a.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4a.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_4b">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4b.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4b.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_4e1">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4e1.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4e1.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_4e2">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4e2.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4e2.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_4e3">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4e3.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_4e3.oggvorbis.ogg"></source>
		</audio> 
		
		<audio id="UNIT2_VO_conclusion">
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_conclusion.mp3"></source>
			<source src="http://www.mx-mx.com/lab/moku/audio/UNIT2_VO_conclusion.oggvorbis.ogg"></source>
		</audio> 

	<!-- old divs by Ryan, probably unneeded -->
	<div id="loadtext"></div>
	<div id="info"></div>
	</body>
</html>
